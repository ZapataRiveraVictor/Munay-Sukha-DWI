<div class="admin-container">
    <div class="header-admin">
        <h1>Panel de AdministraciÃ³n</h1>
        <button (click)="cargarPedidos()" class="btn-refresh">ðŸ”„ Actualizar</button>
    </div>

    <div *ngIf="loading">Cargando pedidos...</div>
    <div *ngIf="errorMensaje" class="error">{{ errorMensaje }}</div>

    <div class="table-responsive" *ngIf="!loading && pedidos.length > 0">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>Total</th>
                    <th>Estado</th>
                    <th>Detalles</th>
                </tr>
            </thead>
            <tbody *ngFor="let p of pedidos">

                <tr [class.expanded]="expandedPedidoId === p.id">
                    <td>#{{ p.id }}</td>
                    <td>{{ p.fechaCreacion | date:'short' }}</td>
                    <td>
                        <div class="client-info">
                            <strong>{{ p.usuario?.nombreCompleto }}</strong>
                            <small>{{ p.usuario?.email }}</small>
                        </div>
                    </td>
                    <td class="price">S/. {{ p.total }}</td>

                    <td>
                        <select [ngModel]="p.estado" (ngModelChange)="cambiarEstado(p, $event)" [ngClass]="p.estado">
                            <option *ngFor="let estado of estadosPosibles" [value]="estado">
                                {{ estado }}
                            </option>
                        </select>
                    </td>

                    <td>
                        <button class="btn-view" (click)="toggleDetalles(p.id)">
                            {{ expandedPedidoId === p.id ? 'Ocultar' : 'Ver Items' }}
                        </button>
                    </td>
                </tr>

                <tr *ngIf="expandedPedidoId === p.id" class="details-row">
                    <td colspan="6">
                        <div class="order-details">
                            <h4>Detalle del Pedido #{{ p.id }}</h4>
                            <p><strong>DirecciÃ³n:</strong> {{ p.direccionEnvio }} - {{ p.ciudad }}</p>

                            <table class="inner-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>P. Unitario</th>
                                        <th>Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of p.items">
                                        <td>{{ item.producto.nombre }}</td>
                                        <td>{{ item.cantidad }}</td>
                                        <td>S/. {{ item.precioUnitario }}</td>
                                        <td>S/. {{ item.precioUnitario * item.cantidad }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>
</div>